<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Page</title>
    <link type="text/css" href="static/css/styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="static/css/index.css" />
</head>

<body>
    <!-- ç¬¬ä¸€é¡µï¼šä¸»é¡µé¢ -->
    <section class="page-section">
        <canvas class="bg-glow" id="bgGlow"></canvas>
        <div class="main-content">
            <div class="left-img">
                <img src="imerge/star.png" id="star-img" alt="star" />
            </div>
            <div class="center-text">
                <span style="font-size:7vw;">BE SLEEPLY !</span><br>
                <span class="creative"> &nbsp &nbsp &nbsp CREATIVE!</span><br>
                <span class="and">AND</span> <span class="cool">LAZY!</span>
            </div>
            <div class="right-geo">
                <img src="imerge/mogu.png" id="mogu-img" alt="mogu" />
            </div>
            <button class="contact-btn" onclick="window.location.href='intro.html'">introduction</button>
            <!-- <button class="view-btn" onclick="scrollToView()" style="position: absolute; bottom: 50px; right: 50px; background: linear-gradient(45deg, #39ff14, #00ff41); color: black; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; z-index: 20; box-shadow: 0 0 20px rgba(57, 255, 20, 0.6); transition: all 0.3s ease;">VIEW</button> -->
            <div class="bottom-tip" onclick="scrollToAscii()">SCROLL CAREFULLY, IT'S SMOOTH<br>å°ãƒ»å¿ƒãƒ»åœ°ãƒ»æ»‘</div>
            <div class="scroll-indicator"></div>

            <div class="music-player"
                style="position:absolute; top:40px; left:40px; z-index:30; background:rgba(20,20,20,0.8); border-radius:16px; box-shadow:0 0 10px #14ffeb; padding:18px 24px; display:flex; align-items:center; gap:16px;">
                <audio id="main-audio" src="static/assets/music.MP3" preload="auto"></audio>
                <button id="volume-btn"
                    style="background:#fff; color:#14ffeb; border:2px solid #14ffeb; border-radius:50%; width:40px; height:40px; font-size:20px; font-weight:bold; cursor:pointer; position:relative;">ğŸ”Š
                    <span id="volume-tip"
                        style="display:none; position:absolute; left:50%; top:-32px; transform:translateX(-50%); background:rgba(20,20,20,0.95); color:#14ffeb; padding:4px 12px; border-radius:8px; font-size:14px; white-space:nowrap; z-index:100; box-shadow:0 0 8px #14ffeb;">é•¿æŒ‰è°ƒèŠ‚éŸ³é‡~</span>
                </button>
                <div style="position:relative; width:220px; height:24px; margin-left:8px;">
                    <div
                        style="position:absolute; top:12px; left:0; width:200px; height:2px; background:#ccc; border-radius:2px;">
                    </div>
                    <div id="volume-bar"
                        style="position:absolute; top:7px; left:0; height:12px; background:#14ffeb; border-radius:6px; width:10%; transition:width 0.1s;">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ç¬¬äºŒé¡µï¼šASCIIåŠ¨ç”»é¡µé¢ -->
    <section class="page-section ascii-section">
        <div class="ascii-container">
            <div class="window-frame">
                <div class="window-header">
                    <div class="window-controls">
                        <div class="window-control"></div>
                        <div class="window-control"></div>
                        <div class="window-control"></div>
                    </div>
                    <div class="window-title">ASCII ANIMATION</div>
                    <div class="window-buttons">
                        <div class="window-btn btn-minimize"></div>
                        <div class="window-btn btn-restore"></div>
                        <div class="window-btn btn-close"></div>
                    </div>
                </div>
                <div class="ascii-display">
                    <pre id="asciiContainer"></pre>
                </div>
            </div>
        </div>
        <div class="bottom-tip" onclick="scrollToContact()"
            style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 20;">NEXT
            PAGE<br>ä¸‹ä¸€é¡µ</div>
    </section>

    <!-- ç¬¬ä¸‰é¡µï¼šè”ç³»é¡µé¢ -->
    <section class="page-section contact-section">
        <div class="contact-container">
            <div class="left-nav">
                <div class="nav-menu">
                    <div class="nav-item active" data-target="home">
                        <span class="chinese">ä¸»é¡µ</span>HOME
                    </div>
                    <div class="nav-item" data-target="videos">
                        <span class="chinese">è§†é¢‘</span>VIDEOS
                    </div>
                    <div class="nav-item" data-target="photos">
                        <span class="chinese">å›¾ç‰‡</span>PHOTOS
                    </div>
                    <div class="nav-item" data-target="contact">
                        <span class="chinese">è”ç³»</span>CONTACT
                    </div>
                </div>
                <div class="contact-info">
                    <div class="contact-title">GET IN TOUCH ///</div>
                    <div class="contact-details">
                        <div><strong>Email:</strong> 3583818830@qq.com</div>
                        <div><strong>Github:</strong> yamatanooroch</div>
                        <div><strong>QQ:</strong> 3583818830</div>
                    </div>
                </div>
                <!-- <div class="copyright">
                    èœ€ICPå¤‡20220223å·-2
                </div> -->
            </div>
            <div class="buildings-container">
                <div class="building building-1" id="building1"></div>
                <div class="building building-2" id="building2"></div>
                <div class="building building-3" id="building3"></div>
                <div class="building building-4" id="building4"></div>
                <div class="building building-5" id="building5"></div>
                <div class="bottom-text">å»è¾¹ç•Œä»¥å¤–å¯»æ‰¾å¯¼èˆªè®¾è®¡!</div>
            </div>
        </div>
        <div class="bottom-tip" onclick="scrollToCreativity()"
            style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 20;">NEXT
            PAGE<br>ä¸‹ä¸€é¡µ</div>
    </section>

    <!-- ç¬¬å››é¡µï¼šåˆ›æ„é¡µé¢ -->
    <section class="page-section creativity-section">
        <div class="creativity-container">
            <div class="left-content">
                <div class="main-text">
                    <h1>FULL OF CREATIVITY</h1>
                    <h2>ABLE TO <span class="highlight">IMAGINE</span></h2>
                    <h3><span class="outline">&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
                            &nbsp&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
                            &nbsp &nbsp &nbsp CLICK</span> THESE CIRCLES</h3>
                </div>
            </div>
            <div class="right-content">
                <img src="imerge/mogu.png" id="mogu-brain" alt="mogu brain" />
            </div>
            <div class="physics-canvas-container">
                <canvas id="physicsCanvas"></canvas>
            </div>
        </div>
        <div class="bottom-tip" onclick="scrollToView()"
            style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 20;">NEXT
            PAGE<br>ä¸‹ä¸€é¡µ</div>
    </section>

    <!-- ç¬¬äº”é¡µï¼šè§†è§‰é¡µé¢ -->
    <section class="page-section view-section">
        <div class="scrolling-text-container">
            <!-- å¥‡æ•°è¡Œå‘å·¦æ»šåŠ¨ -->
            <div class="text-row odd-row">
                <div class="scrolling-text left">VIEW FIRST VISUAL FIRST VIEW FIRST VISUAL FIRST VIEW FIRST VISUAL FIRST
                    VIEW FIRST VISUAL FIRST </div>
            </div>
            <div class="text-row even-row">
                <div class="scrolling-text right">STARE VISUAL STARE VISUAL STARE VISUAL STARE VISUAL STARE VISUAL STARE
                    VISUAL STARE </div>
            </div>
            <div class="text-row odd-row">
                <div class="scrolling-text left">VIEW FIRST VISUAL FIRST VIEW FIRST VISUAL FIRST VIEW FIRST VISUAL FIRST
                    VIEW FIRST VISUAL FIRST </div>
            </div>
            <div class="text-row even-row">
                <div class="scrolling-text right">STARE VISUAL STARE VISUAL STARE VISUAL STARE VISUAL STARE VISUAL STARE
                    VISUAL STARE VISUAL STARE </div>
            </div>
            <div class="text-row odd-row">
                <div class="scrolling-text left">VIEW FIRST VISUAL FIRST VIEW FIRST VISUAL FIRST VIEW FIRST VISUAL FIRST
                    VIEW FIRST VISUAL FIRST </div>
            </div>
            <div class="text-row even-row">
                <div class="scrolling-text right">STARE VISUAL STARE VISUAL STARE VISUAL STARE VISUAL STARE VISUAL STARE
                    VISUAL STARE VISUAL STARE </div>
            </div>
        </div>

        <div class="eye-container">
            <div class="eye-background">
                <div class="eye-pupil">
                    <div class="eye-highlight"></div>
                </div>
                <div class="eye-lines">
                    <div class="line line-1"></div>
                    <div class="line line-2"></div>
                    <div class="line line-3"></div>
                    <div class="line line-4"></div>
                </div>
            </div>
            <div class="corner-markers">
                <div class="corner corner-tl">è§†</div>
                <div class="corner corner-tr">è§‰</div>
                <div class="corner corner-bl">è‡³</div>
                <div class="corner corner-br">ä¸Š</div>
            </div>
        </div>

        <div class="bottom-tip" onclick="scrollToTop()"
            style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 20;">BACK TO
            TOP<br>è¿”å›é¡¶éƒ¨</div>
    </section>

    <!-- æ­å–œé¡µé¢ -->
    <div id="congratulationModal" class="modal">
        <div class="modal-content">
            <h2> CONGRATULATIONS! </h2>
            <p>You've lit up all the creativity bulbs!</p>
            <p>æ‰€æœ‰åˆ›æ„ç¯æ³¡éƒ½è¢«ç‚¹äº®äº†ï¼ğŸ’¡</p>
            <button onclick="closeModal()">Continue</button>
        </div>
    </div>
    <script>
        // é¼ æ ‡è·Ÿéšç»¿è‰²å…‰æ–‘
        const canvas = document.getElementById('bgGlow');
        const ctx = canvas.getContext('2d');
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        let mouseX = window.innerWidth / 2, mouseY = window.innerHeight / 2;
        document.addEventListener('mousemove', e => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        function drawGlow() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // ä¸»å…‰æ–‘
            let grad1 = ctx.createRadialGradient(mouseX, mouseY, 0, mouseX, mouseY, 350);
            grad1.addColorStop(0, 'rgba(20,255,235,0.45)');
            grad1.addColorStop(1, 'rgba(20,255,235,0)');
            ctx.globalCompositeOperation = 'lighter';
            ctx.fillStyle = grad1;
            ctx.fillRect(mouseX - 350, mouseY - 350, 700, 700);
            // è¾¹ç¼˜å…‰æ–‘
            let grad2 = ctx.createRadialGradient(canvas.width - mouseX, canvas.height - mouseY, 0, canvas.width - mouseX, canvas.height - mouseY, 300);
            grad2.addColorStop(0, 'rgba(20,255,235,0.25)');
            grad2.addColorStop(1, 'rgba(20,255,235,0)');
            ctx.fillStyle = grad2;
            ctx.fillRect(canvas.width - mouseX - 300, canvas.height - mouseY - 300, 600, 600);
            ctx.globalCompositeOperation = 'source-over';
        }
        setInterval(drawGlow, 16);

        // star.pngæ—‹è½¬åŠ¨ç”»
        const starImg = document.getElementById('star-img');
        let starAngle = 0;
        function rotateStar() {
            starAngle += 1.2;
            starImg.style.transform = `rotate(${starAngle}deg)`;
            requestAnimationFrame(rotateStar);
        }

        rotateStar();

        // moguå›¾ç‰‡éšæœºç§»åŠ¨åŠ¨ç”»
        const moguImg = document.getElementById('mogu-img');
        let isAnimating = false;

        moguImg.addEventListener('mouseenter', function (e) {
            if (isAnimating) return;

            isAnimating = true;
            const mouseX = e.clientX;
            const mouseY = e.clientY;

            // ç”Ÿæˆéšæœºè§’åº¦å’Œ100pxè·ç¦»
            const angle = Math.random() * 2 * Math.PI;
            const distance = 100;

            // è®¡ç®—æ–°ä½ç½®
            const newX = mouseX + Math.cos(angle) * distance;
            const newY = mouseY + Math.sin(angle) * distance;

            // è·å–å›¾ç‰‡å½“å‰ä½ç½®
            const rect = moguImg.getBoundingClientRect();
            const currentX = rect.left + rect.width / 2;
            const currentY = rect.top + rect.height / 2;

            // è®¡ç®—ç§»åŠ¨è·ç¦»
            const moveX = newX - currentX;
            const moveY = newY - currentY;

            // åº”ç”¨å˜æ¢
            moguImg.style.transform = `translate(${moveX}px, ${moveY}px) scale(1.1)`;
            moguImg.style.filter = 'brightness(1.2) drop-shadow(0 0 20px rgba(20, 255, 235, 0.8))';

            // 1ç§’åæ¢å¤åŸä½
            setTimeout(() => {
                moguImg.style.transform = 'translate(0, 0) scale(1)';
                moguImg.style.filter = 'brightness(1) drop-shadow(0 0 15px rgba(20, 255, 235, 0.3))';
                isAnimating = false;
            }, 1000);
        });

        // æ»šåŠ¨åŠŸèƒ½
        function scrollToAscii() {
            document.querySelector('.ascii-section').scrollIntoView({
                behavior: 'smooth'
            });
        }

        function scrollToContact() {
            document.querySelector('.contact-section').scrollIntoView({
                behavior: 'smooth'
            });
        }

        function scrollToCreativity() {
            document.querySelector('.creativity-section').scrollIntoView({
                behavior: 'smooth'
            });
        }

        function scrollToTop() {
            document.querySelector('.page-section').scrollIntoView({
                behavior: 'smooth'
            });
        }

        // æ»šåŠ¨åˆ°ç¬¬äº”é¡µçš„å‡½æ•°
        function scrollToView() {
            document.querySelector('.view-section').scrollIntoView({
                behavior: 'smooth'
            });
        }

        // çœ¼ç›è·Ÿè¸ªé¼ æ ‡æ•ˆæœ
        function initEyeTracking() {
            const eyePupil = document.querySelector('.eye-pupil');
            const eyeBackground = document.querySelector('.eye-background');
            const viewSection = document.querySelector('.view-section');

            if (!eyePupil || !eyeBackground || !viewSection) return;

            let isEyeTrackingActive = false;

            // ä½¿ç”¨Intersection Observeræ£€æµ‹ç¬¬äº”é¡µæ˜¯å¦å¯è§
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.target === viewSection) {
                        isEyeTrackingActive = entry.isIntersecting;
                        if (!isEyeTrackingActive) {
                            // å½“ç¦»å¼€ç¬¬äº”é¡µæ—¶ï¼Œé‡ç½®ç³å­”ä½ç½®
                            eyePupil.style.transform = 'translate(0px, 0px)';
                        }
                    }
                });
            }, {
                threshold: 0.3 // å½“30%å¯è§æ—¶æ¿€æ´»
            });

            observer.observe(viewSection);

            document.addEventListener('mousemove', function (e) {
                if (!isEyeTrackingActive) return;

                // è·å–çœ¼çƒä¸­å¿ƒä½ç½®
                const eyeRect = eyeBackground.getBoundingClientRect();
                const eyeCenterX = eyeRect.left + eyeRect.width / 2;
                const eyeCenterY = eyeRect.top + eyeRect.height / 2;

                // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºçœ¼çƒä¸­å¿ƒçš„ä½ç½®
                const mouseX = e.clientX - eyeCenterX;
                const mouseY = e.clientY - eyeCenterY;

                // è®¡ç®—è·ç¦»å’Œè§’åº¦
                const distance = Math.sqrt(mouseX * mouseX + mouseY * mouseY);
                const angle = Math.atan2(mouseY, mouseX);

                // é™åˆ¶ç³å­”ç§»åŠ¨èŒƒå›´ï¼ˆçœ¼çƒåŠå¾„çš„30%ï¼‰
                const maxDistance = 45; // çœ¼çƒåŠå¾„150pxçš„30%
                const limitedDistance = Math.min(distance * 0.3, maxDistance);

                // è®¡ç®—ç³å­”æ–°ä½ç½®
                const pupilX = Math.cos(angle) * limitedDistance;
                const pupilY = Math.sin(angle) * limitedDistance;

                // åº”ç”¨å˜æ¢
                eyePupil.style.transform = `translate(${pupilX}px, ${pupilY}px)`;

                // è®©é«˜å…‰ä¹Ÿè·Ÿç€ç§»åŠ¨ï¼Œä½†ç§»åŠ¨å¹…åº¦æ›´å°
                const eyeHighlight = eyePupil.querySelector('.eye-highlight');
                if (eyeHighlight) {
                    const highlightX = pupilX * 0.3;
                    const highlightY = pupilY * 0.3;
                    eyeHighlight.style.transform = `translate(${highlightX}px, ${highlightY}px)`;
                }
            });
        }

        // ç¬¬ä¸‰é¡µå¯¼èˆªäº¤äº’
        document.addEventListener('DOMContentLoaded', function () {
            const navItems = document.querySelectorAll('.nav-item');

            navItems.forEach(item => {
                item.addEventListener('mouseenter', function () {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    navItems.forEach(nav => nav.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰é¡¹
                    this.classList.add('active');
                });
            });

            // åˆ›å»ºå»ºç­‘ç‰©çª—æˆ·
            createBuildingWindows();

            // è®¾ç½®ç¬¬ä¸‰é¡µæ»‘åŠ¨åŠ¨ç”»è§‚å¯Ÿå™¨
            setupThirdPageAnimation();

            // åˆå§‹åŒ–ç‰©ç†å¼•æ“
            initPhysicsEngine();

            // åˆå§‹åŒ–çœ¼ç›è·Ÿè¸ªæ•ˆæœ
            initEyeTracking();
        });

        // è®¾ç½®ç¬¬ä¸‰é¡µåŠ¨ç”»è§‚å¯Ÿå™¨
        function setupThirdPageAnimation() {
            const contactSection = document.querySelector('.contact-section');
            const navItems = document.querySelectorAll('.nav-item');

            // åˆå§‹çŠ¶æ€ï¼šç§»é™¤æ‰€æœ‰åŠ¨ç”»ï¼Œéšè—å¯¼èˆªé¡¹
            navItems.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-100px)';
                item.style.animation = 'none';
            });

            // åˆ›å»ºè§‚å¯Ÿå™¨
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // é¡µé¢è¿›å…¥è§†çª—ï¼Œå¯åŠ¨åŠ¨ç”»
                        startNavAnimation();
                    } else {
                        // é¡µé¢ç¦»å¼€è§†çª—ï¼Œé‡ç½®åŠ¨ç”»
                        resetNavAnimation();
                    }
                });
            }, {
                threshold: 0.3 // å½“30%çš„é¡µé¢å¯è§æ—¶è§¦å‘
            });

            observer.observe(contactSection);
        }

        // å¯åŠ¨å¯¼èˆªåŠ¨ç”»
        function startNavAnimation() {
            const navItems = document.querySelectorAll('.nav-item');

            navItems.forEach((item, index) => {
                // é‡æ–°åº”ç”¨åŠ¨ç”»
                item.style.animation = `slideInLeft 0.6s ease forwards`;
                item.style.animationDelay = `${0.1 * (index + 1)}s`;
            });
        }

        // é‡ç½®å¯¼èˆªåŠ¨ç”»
        function resetNavAnimation() {
            const navItems = document.querySelectorAll('.nav-item');

            navItems.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-100px)';
                item.style.animation = 'none';
            });
        }

        // åˆ›å»ºå»ºç­‘ç‰©çª—æˆ·
        function createBuildingWindows() {
            const buildings = [
                { id: 'building1', windows: 12 },
                { id: 'building2', windows: 20 },
                { id: 'building3', windows: 30 },
                { id: 'building4', windows: 16 },
                { id: 'building5', windows: 10 }
            ];

            buildings.forEach(building => {
                const buildingEl = document.getElementById(building.id);
                if (!buildingEl) return;

                for (let i = 0; i < building.windows; i++) {
                    const window = document.createElement('div');
                    window.className = 'window';

                    // éšæœºå†³å®šæ˜¯å¦ç‚¹äº®çª—æˆ·
                    if (Math.random() > 0.6) {
                        window.classList.add('lit');
                    }

                    // éšæœºä½ç½®
                    const x = 10 + (i % 4) * 18;
                    const y = 15 + Math.floor(i / 4) * 20;

                    window.style.left = x + 'px';
                    window.style.top = y + 'px';

                    buildingEl.appendChild(window);
                }
            });
        }

        // ç¬¬å››é¡µç‰©ç†å¼•æ“
        class PhysicsEngine {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.circles = [];
                this.gravity = 0.3;
                this.friction = 0.98;
                this.bounceDamping = 0.8;
                this.scrollForce = 0;
                this.totalCircles = 15;
                this.filledCircles = 0;

                // é¢„åŠ è½½ç¯æ³¡å›¾ç‰‡
                this.lightOffImg = new Image();
                this.lightOnImg = new Image();
                this.lightOffImg.src = 'imerge/lightoff.png';
                this.lightOnImg.src = 'imerge/lighton.png';

                // ç¯æ³¡çš„å®é™…å¤§å°å’Œç¢°æ’åŒºåŸŸï¼ˆåŸºäºç¯æ³¡è½®å»“ï¼‰
                this.bulbWidth = 40;
                this.bulbHeight = 60;
                this.bulbCollisionRadius = 20; // ç¯æ³¡ä¸»ä½“çš„ç¢°æ’åŠå¾„

                this.resizeCanvas();
                this.initCircles();
                this.animate();

                window.addEventListener('resize', () => this.resizeCanvas());
                canvas.addEventListener('click', (e) => this.handleClick(e));

                // ç›‘å¬æ»šåŠ¨
                let lastScrollY = window.scrollY;
                window.addEventListener('scroll', () => {
                    const currentScrollY = window.scrollY;
                    const scrollDelta = currentScrollY - lastScrollY;
                    this.scrollForce = scrollDelta * 0.1;
                    lastScrollY = currentScrollY;
                });
            }

            resizeCanvas() {
                this.canvas.width = this.canvas.offsetWidth;
                this.canvas.height = this.canvas.offsetHeight;
            }

            initCircles() {
                this.circles = [];
                for (let i = 0; i < this.totalCircles; i++) {
                    this.circles.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        radius: this.bulbCollisionRadius, // ä½¿ç”¨ç¯æ³¡ç¢°æ’åŠå¾„
                        filled: false, // falseè¡¨ç¤ºç¯ç­ï¼Œtrueè¡¨ç¤ºç¯äº®
                        color: '#14ffeb',
                        width: this.bulbWidth,
                        height: this.bulbHeight
                    });
                }
            }

            handleClick(e) {
                const rect = this.canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;

                this.circles.forEach(circle => {
                    // æ£€æŸ¥ç‚¹å‡»æ˜¯å¦åœ¨ç¯æ³¡çš„ç¢°æ’åŒºåŸŸå†…ï¼ˆæ¤­åœ†å½¢åŒºåŸŸï¼‰
                    const dx = clickX - circle.x;
                    const dy = clickY - circle.y;

                    // ä½¿ç”¨æ¤­åœ†ç¢°æ’æ£€æµ‹ï¼Œç¯æ³¡ä¸»ä½“åŒºåŸŸ
                    const normalizedX = dx / (circle.width * 0.4); // å®½åº¦çš„40%ä½œä¸ºç¢°æ’åŒºåŸŸ
                    const normalizedY = dy / (circle.height * 0.5); // é«˜åº¦çš„50%ä½œä¸ºç¢°æ’åŒºåŸŸ
                    const distance = Math.sqrt(normalizedX * normalizedX + normalizedY * normalizedY);

                    if (distance <= 1 && !circle.filled) {
                        circle.filled = true;
                        this.filledCircles++;

                        // æ·»åŠ ç‚¹å‡»æ•ˆæœ
                        circle.vx += (Math.random() - 0.5) * 5;
                        circle.vy -= Math.random() * 3 + 2;

                        if (this.filledCircles === this.totalCircles) {
                            setTimeout(() => this.showCongratulations(), 500);
                        }
                    }
                });
            }

            showCongratulations() {
                document.getElementById('congratulationModal').style.display = 'block';
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                this.circles.forEach(circle => {
                    // åº”ç”¨é‡åŠ›
                    circle.vy += this.gravity;

                    // åº”ç”¨æ»šåŠ¨åŠ›
                    circle.vy += this.scrollForce;

                    // åº”ç”¨æ‘©æ“¦åŠ›
                    circle.vx *= this.friction;
                    circle.vy *= this.friction;

                    // æ›´æ–°ä½ç½®
                    circle.x += circle.vx;
                    circle.y += circle.vy;

                    // è¾¹ç•Œç¢°æ’ï¼ˆè€ƒè™‘ç¯æ³¡å›¾ç‰‡çš„å®é™…å°ºå¯¸ï¼‰
                    const halfWidth = circle.width / 2;
                    const halfHeight = circle.height / 2;

                    if (circle.x < halfWidth) {
                        circle.x = halfWidth;
                        circle.vx *= -this.bounceDamping;
                    }
                    if (circle.x > this.canvas.width - halfWidth) {
                        circle.x = this.canvas.width - halfWidth;
                        circle.vx *= -this.bounceDamping;
                    }
                    if (circle.y < halfHeight) {
                        circle.y = halfHeight;
                        circle.vy *= -this.bounceDamping;
                    }
                    if (circle.y > this.canvas.height - halfHeight) {
                        circle.y = this.canvas.height - halfHeight;
                        circle.vy *= -this.bounceDamping;
                    }

                    // ç¯æ³¡ç¢°æ’æ£€æµ‹ï¼ˆåŸºäºç¯æ³¡è½®å»“çš„åœ†å½¢åŒºåŸŸï¼‰
                    this.circles.forEach(other => {
                        if (other !== circle) {
                            const dx = other.x - circle.x;
                            const dy = other.y - circle.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            const minDistance = circle.radius + other.radius;

                            if (distance < minDistance) {
                                const angle = Math.atan2(dy, dx);
                                const targetX = circle.x + Math.cos(angle) * minDistance;
                                const targetY = circle.y + Math.sin(angle) * minDistance;
                                const ax = (targetX - other.x) * 0.1;
                                const ay = (targetY - other.y) * 0.1;

                                circle.vx -= ax;
                                circle.vy -= ay;
                                other.vx += ax;
                                other.vy += ay;
                            }
                        }
                    });

                    // ç»˜åˆ¶ç¯æ³¡å›¾ç‰‡
                    const img = circle.filled ? this.lightOnImg : this.lightOffImg;

                    // å¦‚æœå›¾ç‰‡å·²åŠ è½½å®Œæˆï¼Œåˆ™ç»˜åˆ¶å›¾ç‰‡
                    if (img.complete && img.naturalHeight !== 0) {
                        // æ·»åŠ å‘å…‰æ•ˆæœ
                        if (circle.filled) {
                            this.ctx.shadowColor = '#ffff00';
                            this.ctx.shadowBlur = 20;
                        }

                        // ç»˜åˆ¶ç¯æ³¡å›¾ç‰‡ï¼Œä»¥circle.x, circle.yä¸ºä¸­å¿ƒ
                        this.ctx.drawImage(
                            img,
                            circle.x - circle.width / 2,
                            circle.y - circle.height / 2,
                            circle.width,
                            circle.height
                        );

                        this.ctx.shadowBlur = 0;
                    } else {
                        // å›¾ç‰‡æœªåŠ è½½å®Œæˆæ—¶ï¼Œç»˜åˆ¶å ä½åœ†åœˆ
                        this.ctx.beginPath();
                        this.ctx.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2);

                        if (circle.filled) {
                            this.ctx.fillStyle = '#ffff00';
                            this.ctx.fill();
                            this.ctx.shadowColor = '#ffff00';
                            this.ctx.shadowBlur = 15;
                        } else {
                            this.ctx.strokeStyle = circle.color;
                            this.ctx.lineWidth = 3;
                            this.ctx.stroke();
                        }

                        this.ctx.shadowBlur = 0;
                    }
                });

                // å‡å°‘æ»šåŠ¨åŠ›
                this.scrollForce *= 0.9;

                requestAnimationFrame(() => this.animate());
            }
        }

        // æ­å–œå¼¹çª—åŠŸèƒ½
        function closeModal() {
            document.getElementById('congratulationModal').style.display = 'none';
        }

        // åˆå§‹åŒ–ç‰©ç†å¼•æ“
        let physicsEngine;
        function initPhysicsEngine() {
            const canvas = document.getElementById('physicsCanvas');
            if (canvas) {
                physicsEngine = new PhysicsEngine(canvas);
            }
        }

    </script>


    <script type="module">






        import { parseGIF, decompressFrames } from 'https://cdn.jsdelivr.net/npm/gifuct-js@2.1.2/+esm';

        // è·å–ASCIIæ˜¾ç¤ºå®¹å™¨
        const asciiContainer = document.getElementById('asciiContainer');
        asciiContainer.style.color = '#14ffeb';
        asciiContainer.style.fontFamily = 'monospace';
        asciiContainer.style.fontSize = '8px';
        asciiContainer.style.lineHeight = '1.0';
        asciiContainer.style.margin = '0';
        asciiContainer.style.padding = '0';
        asciiContainer.style.textAlign = 'center';
        asciiContainer.style.width = '100%';
        asciiContainer.style.height = '100%';
        asciiContainer.style.display = 'flex';
        asciiContainer.style.alignItems = 'center';
        asciiContainer.style.justifyContent = 'center';
        asciiContainer.style.whiteSpace = 'pre';
        asciiContainer.style.overflow = 'hidden';

        const scale_nums = 2; // æ§åˆ¶ASCIIåˆ†è¾¨ç‡ï¼Œæ•°å€¼è¶Šå°åˆ†è¾¨ç‡è¶Šé«˜
        let texts = [];
        let current_text_index = 0;

        function create_texts(data, width, height) {
            let text = "";
            const levels = [["@", "#", "S", "%", "?", "*", "+", ";", ":", ",", ".", " "], ["0", "1"], [".", "*"], [" "]];
            for (let y = 0; y < height; y += scale_nums) {
                let row = "";
                for (let x = 0; x < width; x += scale_nums) {
                    const i = (y * width + x) * 4;
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    const level = levels[0][Math.floor(avg / 255 * (levels[0].length - 1))];
                    row += level;
                }
                text += row + "\n";
            }
            return text;
        }

        const ascllbox = {
            init() {
                fetch('imerge/head.gif')
                    .then(response => response.arrayBuffer())
                    .then(buffer => {
                        const gif = parseGIF(buffer);
                        const frames = decompressFrames(gif, true);
                        texts = frames.map(frame => {
                            // åˆ›å»ºcanvasè·å–åƒç´ æ•°æ®
                            const canvas = document.createElement('canvas');
                            canvas.width = frame.dims.width;
                            canvas.height = frame.dims.height;
                            const ctx = canvas.getContext('2d');
                            const imageData = new ImageData(frame.patch, frame.dims.width, frame.dims.height);
                            ctx.putImageData(imageData, 0, 0);
                            const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                            return create_texts(data, canvas.width, canvas.height);
                        });
                        // å®šæ—¶åˆ‡æ¢æ˜¾ç¤º
                        setInterval(() => {
                            current_text_index = (current_text_index + 1) % texts.length;
                            asciiContainer.innerText = texts[current_text_index];
                        }, 80);
                    })
                    .catch(error => console.error('Error loading GIF:', error));
            }
        };
        ascllbox.init();

    </script>
    <script src="static/js/music-player.js"></script>
</body>

</html>